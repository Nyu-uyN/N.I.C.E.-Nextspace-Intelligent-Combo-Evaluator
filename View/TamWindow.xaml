<Window x:Class="N.I.C.E.___Nextspace_Intelligent_Combo_Evaluator.View.TamWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:N.I.C.E.___Nextspace_Intelligent_Combo_Evaluator.View"
        mc:Ignorable="d"
        Title="T.A.M. - Tag Attribute Manager" 
        Height="850" Width="1400"
        WindowStartupLocation="CenterOwner"
        Background="#F5F5F5">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <LinearGradientBrush x:Key="FinBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#AADCF7" Offset="1"/>
            <GradientStop Color="#32369B" Offset="0"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="BodyBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#AADCF7" Offset="0"/>
            <GradientStop Color="#363795" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="FlameBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FFFFD5" Offset="0"/>
            <GradientStop Color="#FF6F59" Offset="1"/>
        </LinearGradientBrush>

        <SolidColorBrush x:Key="Text.Error" Color="#D9534F"/>
    </Window.Resources>

    <Grid>
        <Grid Margin="15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <GroupBox Header="TAG MASTER LIST" Grid.Column="0" Margin="0,0,10,0" Padding="5">
                <DockPanel>
                    <Border DockPanel.Dock="Top" Background="White" BorderBrush="#CCC" BorderThickness="1" Margin="0,0,0,10" Padding="5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="🔍" VerticalAlignment="Center" Margin="5,0" Foreground="Gray"/>
                            <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                                     BorderThickness="0" VerticalContentAlignment="Center" FontSize="13"/>
                        </Grid>
                    </Border>

                    <DataGrid ItemsSource="{Binding TagView}" 
                              SelectedItem="{Binding SelectedTag}"
                              AutoGenerateColumns="False" 
                              IsReadOnly="True" 
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal" 
                              BorderThickness="1" 
                              BorderBrush="#DDD"
                              VerticalContentAlignment="Center">
                        <DataGrid.Style>
                            <Style TargetType="DataGrid" BasedOn="{StaticResource {x:Type DataGrid}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasValidationError}" Value="True">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="Opacity" Value="0.6"/>
                                        <Setter Property="ToolTip" Value="Please fix current errors before changing tag."/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                            
                        </DataGrid.Style>
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsDirty}" Value="True">
                                        <Setter Property="Background" Value="#FFFDE7"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="ID" Width="60">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="*" 
                               Foreground="#FFA000" 
                               FontWeight="Black" 
                               FontSize="16"
                               VerticalAlignment="Center"
                               Margin="0,0,3,0">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsDirty}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <TextBlock Text="{Binding Index}" VerticalAlignment="Center" Width="45"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            
                            <DataGridTextColumn Header="NAME" Binding="{Binding Name}" Width="150" FontWeight="SemiBold"/>
                            <DataGridTextColumn Header="DESCRIPTION" Binding="{Binding Description}" Width="250">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="RARITY" Binding="{Binding Rarity}" Width="85"/>

                            <DataGridTemplateColumn Header="CONTROVERSIAL" Width="110">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock TextAlignment="Center" VerticalAlignment="Center" FontSize="14">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="❌"/>
                                                    <Setter Property="Foreground" Value="#D9534F"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsControversial}" Value="True">
                                                            <Setter Property="Text" Value="✔️"/>
                                                            <Setter Property="Foreground" Value="#5CB85C"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="MISSION" Width="85">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock TextAlignment="Center" VerticalAlignment="Center" FontSize="14">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="❌"/>
                                                    <Setter Property="Foreground" Value="#D9534F"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsStoryMission}" Value="True">
                                                            <Setter Property="Text" Value="✔️"/>
                                                            <Setter Property="Foreground" Value="#5CB85C"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="CATEGORIES" Binding="{Binding Categories}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </GroupBox>

            <GroupBox Header="TAG ATTRIBUTES EDITOR" Grid.Column="1" Padding="10">
                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid">
                            <Setter Property="IsEnabled" Value="True"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedTag}" Value="{x:Null}">
                                    <Setter Property="IsEnabled" Value="False"/>
                                    <Setter Property="Opacity" Value="0.5"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="#EFEFEF" Padding="15" Margin="0,0,0,15" CornerRadius="3">
                        <DockPanel>
                            <StackPanel DockPanel.Dock="Left">
                                <TextBlock Text="TAG ID" FontSize="10" Foreground="Gray" FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedTag.Index}" FontSize="24" FontWeight="Black" Foreground="#007ACC"/>
                            </StackPanel>

                            <StackPanel DockPanel.Dock="Right" HorizontalAlignment="Right" VerticalAlignment="Center">
                                <Button Content="Reset to Session" Command="{Binding RevertSelectedToSessionCommand}" 
                                        Margin="0,0,0,5" Padding="10,4" FontSize="11" />
                                <Button Content="Revert to Default" Command="{Binding RevertSelectedToDefaultCommand}" 
                                        Padding="10,4" FontSize="11" />
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="10,0">
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="DISPLAY NAME" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                                    <TextBox Text="{Binding SelectedTag.Name, UpdateSourceTrigger=PropertyChanged}" Padding="8" FontSize="16" FontWeight="Bold">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                                <Style.Triggers>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding SelectedTag.Name}" Value=""/>
                                                        </MultiDataTrigger.Conditions>
                                                        <Setter Property="BorderBrush" Value="#D9534F"/>
                                                        <Setter Property="BorderThickness" Value="2"/>
                                                    </MultiDataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="RARITY" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                                    <ComboBox SelectedValue="{Binding SelectedTag.Rarity}" 
                                              SelectedValuePath="Content"
                                              Height="41" VerticalContentAlignment="Center">
                                        <ComboBoxItem Content="Common"/>
                                        <ComboBoxItem Content="Uncommon"/>
                                        <ComboBoxItem Content="Rare"/>
                                        <ComboBoxItem Content="Epic"/>
                                        <ComboBoxItem Content="Viral"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="DESCRIPTION" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <TextBox Text="{Binding SelectedTag.Description, UpdateSourceTrigger=PropertyChanged}" 
                                     Margin="0,5,0,20" Padding="8" Height="100" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto">
                                <TextBox.Style>
                                    <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding SelectedTag.Description}" Value=""/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="BorderBrush" Value="#D9534F"/>
                                                <Setter Property="BorderThickness" Value="2"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBox.Style>
                            </TextBox>
                            
                            <Border BorderBrush="#EEE" BorderThickness="1" Padding="10" Background="White" Margin="0,0,0,20">
                                <UniformGrid Columns="2">
                                    <CheckBox Content="CONTROVERSIAL" 
                                        IsChecked="{Binding SelectedTag.IsControversial}" 
                                        FontWeight="Bold" VerticalAlignment="Center"/>
                                    <CheckBox Content="MISSION" 
                                        IsChecked="{Binding SelectedTag.IsStoryMission}" 
                                        FontWeight="Bold" VerticalAlignment="Center"/>
                                </UniformGrid>
                            </Border>

                            <Separator Background="#DDD" Margin="0,0,0,20"/>

                            <TextBlock Text="CATEGORIES (RECALCULATION REQUIRED)" FontWeight="Bold" Foreground="#007ACC" FontSize="11" Margin="0,0,0,10"/>
                            <Border BorderBrush="#EEE" BorderThickness="1" Padding="15" Background="White">
                                <UniformGrid Columns="2">
                                    <CheckBox Content="COOL" IsChecked="{Binding IsCool}" Margin="0,5"/>
                                    <CheckBox Content="WEIRD" IsChecked="{Binding IsWeird}" Margin="0,5"/>
                                    <CheckBox Content="CLEVER" IsChecked="{Binding IsClever}" Margin="0,5"/>
                                    <CheckBox Content="FUNNY" IsChecked="{Binding IsFunny}" Margin="0,5"/>
                                    <CheckBox Content="AWESOME" IsChecked="{Binding IsAwesome}" Margin="0,5"/>
                                    <CheckBox Content="CREEPY" IsChecked="{Binding IsCreepy}" Margin="0,5"/>
                                    <CheckBox Content="CUTE" IsChecked="{Binding IsCute}" Margin="0,5"/>
                                    <CheckBox Content="NOOB" IsChecked="{Binding IsNoob}" Margin="0,5"/>
                                    <CheckBox Content="GROSS" IsChecked="{Binding IsGross}" Margin="0,5"/>
                                    <CheckBox Content="NAUGHTY" IsChecked="{Binding IsNaughty}" Margin="0,5"/>
                                    <CheckBox Content="WILD" IsChecked="{Binding IsWild}" Margin="0,5"/>
                                    <CheckBox Content="ASPIRING" IsChecked="{Binding IsAspiring}" Margin="0,5"/>
                                    <CheckBox Content="NERDY" IsChecked="{Binding IsNerdy}" Margin="0,5"/>
                                </UniformGrid>
                            </Border>

                            <TextBlock Text="{Binding ValidationError}" Foreground="{StaticResource Text.Error}" 
                                       FontWeight="Bold" Margin="0,20,0,0" HorizontalAlignment="Center" TextWrapping="Wrap"
                                       Visibility="{Binding ValidationError, Converter={StaticResource BoolToVis}}"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </GroupBox>

            <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                    Background="White" Margin="0,15,0,0" Padding="15" BorderBrush="#CCC" BorderThickness="0,1,0,0">
                <DockPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" 
                                Visibility="{Binding HasPendingStructuralChanges, Converter={StaticResource BoolToVis}}">
                        <TextBlock Text="⚠️" FontSize="16" Margin="0,0,10,0"/>
                        <TextBlock Text="CATEGORIES OR RARITIES CHANGED - RECALCULATION REQUIRED" 
                                   FontWeight="Bold" Foreground="#D9534F" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0"
                        Visibility="{Binding HasValidationError, Converter={StaticResource BoolToVis}}">
                        <TextBlock Text="🛑" FontSize="16" Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding ValidationError}" 
                           Foreground="#D9534F" 
                           FontWeight="Bold" 
                           VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="REVERT ALL TO DEFAULT" Command="{Binding RevertAllToDefaultCommand}"
                                Background="#D9534F" Foreground="White" Padding="15,8" Margin="0,0,10,0"/>

                        <Button Content="REVERT ALL TO SESSION" Command="{Binding RevertAllToSessionCommand}"
                                Padding="15,8" Margin="0,0,10,0"/>

                        <Button Content="COMMIT &amp; SAVE" Command="{Binding CommitCommand}"
                                Background="#007ACC" Foreground="White" Padding="35,8" FontWeight="Black"
                                IsEnabled="{Binding HasPendingChanges}"/>
                    </StackPanel>
                </DockPanel>
            </Border>
        </Grid>

        <Grid Background="#DD0A0A0F" Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}" Panel.ZIndex="999">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <Viewbox Width="200" Height="200">
                    <Canvas Width="800" Height="800">
                        <Ellipse Canvas.Left="153" Canvas.Top="153" Width="494" Height="494" Fill="#F1F3F5"/>
                        <Path Data="M430,530 s44,38 -30,162 c-74,-123 -30,-162 -30,-162" Fill="{StaticResource FlameBrush}" Opacity="0.8"/>
                        <Polygon Points="474,371 544,444 510,643 485,513 427,483" Fill="{StaticResource FinBrush}"/>
                        <Polygon Points="325,371 255,444 289,643 314,513 372,483" Fill="{StaticResource FinBrush}"/>
                        <Path Data="M442,515 S480,470 480,330 c0-50 4-158 -80-220 c-84,61 -80,170 -80,220 0,140 37,185 37,185 Z" Fill="{StaticResource BodyBrush}"/>
                        <Ellipse Canvas.Left="350" Canvas.Top="224" Width="100" Height="100" Fill="#AADCF7"/>
                        <Ellipse Canvas.Left="359" Canvas.Top="233" Width="82" Height="82" Fill="#110B39"/>
                    </Canvas>
                </Viewbox>
                <TextBlock Text="SAVING &amp; RECALCULATING..." Foreground="White" FontSize="24" FontWeight="Black" HorizontalAlignment="Center" Margin="0,20,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>